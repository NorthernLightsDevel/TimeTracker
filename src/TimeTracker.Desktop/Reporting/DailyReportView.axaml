<UserControl
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="clr-namespace:Avalonia.Controls;assembly=Avalonia.Controls.DataGrid"
    xmlns:reporting="clr-namespace:TimeTracker.Desktop.Reporting"
    x:Class="TimeTracker.Desktop.Reporting.DailyReportView"
    x:CompileBindings="True"
    x:DataType="reporting:DailyReportViewModel">
  <Grid RowDefinitions="Auto,*" RowSpacing="12">
    <StackPanel Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
      <TextBlock Text="Today &amp; Recent Activity" FontWeight="SemiBold" FontSize="16" />
      <TextBlock Text="{Binding LastUpdatedDisplay, StringFormat='Updated {0}'}"
                 Classes="caption"
                 VerticalAlignment="Center"
                 Foreground="#888888" />
      <Button Content="Refresh"
              Command="{Binding RefreshCommand}"
              HorizontalAlignment="Left" />
      <Button Content="Export week CSV"
              Click="OnExportWeekClicked"
              HorizontalAlignment="Left" />
      <Button Content="Export month CSV"
              Click="OnExportMonthClicked"
              HorizontalAlignment="Left" />
    </StackPanel>

    <Grid Grid.Row="1">
      <TextBlock Text="No entries recorded yet. Start tracking time to see daily totals here."
                 HorizontalAlignment="Center"
                 VerticalAlignment="Center"
                 Foreground="#888888"
                 Classes="caption"
                 TextAlignment="Center"
                 MaxWidth="320"
                 IsVisible="{Binding HasNoResults}" />

      <Border BorderThickness="1"
              BorderBrush="#3A3A3A"
              CornerRadius="12"
              Padding="8"
              Background="#1a1a1a"
              IsVisible="{Binding HasResults}">
        <ScrollViewer>
          <ItemsControl ItemsSource="{Binding Groups}" Margin="4">
            <ItemsControl.ItemTemplate>
              <DataTemplate x:DataType="reporting:DailyReportGroupViewModel">
                <Border BorderThickness="1"
                        BorderBrush="#303030"
                        CornerRadius="10"
                        Padding="12"
                        Margin="0,0,0,12"
                        Background="#232323">
                  <StackPanel Spacing="10">
                    <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto">
                      <StackPanel>
                        <TextBlock Text="{Binding DateDisplay}"
                                   FontWeight="SemiBold"
                                   FontSize="15" />
                        <TextBlock Text="Today"
                                   Foreground="#AFD275"
                                   Classes="caption"
                                   FontWeight="SemiBold"
                                   IsVisible="{Binding IsToday}" />
                        <TextBlock Text="{Binding DayOfWeekDisplay}"
                                   Foreground="#BBBBBB"
                                   Classes="caption" />
                      </StackPanel>
                      <StackPanel Grid.Column="1"
                                  HorizontalAlignment="Right"
                                  Spacing="6">
                        <TextBlock Text="{Binding TotalDurationDisplay, StringFormat='Total: {0}'}"
                                   FontWeight="SemiBold"
                                   HorizontalAlignment="Right" />
                        <TextBlock Text="{Binding TotalRoundedDurationDisplay, StringFormat='Rounded: {0}'}"
                                   Foreground="#CCCCCC"
                                   HorizontalAlignment="Right" />
                      </StackPanel>
                    </Grid>

                    <controls:DataGrid ItemsSource="{Binding Entries}"
                                       HeadersVisibility="Column"
                                       IsReadOnly="True"
                                       RowHeight="30"
                                       CanUserReorderColumns="False"
                                       CanUserResizeColumns="False"
                                       AutoGenerateColumns="False"
                                       CanUserSortColumns="True"
                                       Background="#262626">
                      <controls:DataGrid.Columns>
                        <controls:DataGridTextColumn Header="Project" Binding="{Binding ProjectName}" Width="2*" />
                        <controls:DataGridTextColumn Header="Start" Binding="{Binding StartLocal, StringFormat='{}{0:HH\\:mm}'}" Width="*" />
                        <controls:DataGridTextColumn Header="End" Binding="{Binding EndLocal, StringFormat='{}{0:HH\\:mm}'}" Width="*" />
                        <controls:DataGridTextColumn Header="Duration" Binding="{Binding DurationDisplay}" Width="*" />
                        <controls:DataGridTextColumn Header="Rounded" Binding="{Binding RoundedDurationDisplay}" Width="*" />
                        <controls:DataGridTextColumn Header="Notes" Binding="{Binding Notes}" Width="3*" />
                      </controls:DataGrid.Columns>
                    </controls:DataGrid>
                  </StackPanel>
                </Border>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
        </ScrollViewer>
      </Border>
    </Grid>
  </Grid>
</UserControl>
