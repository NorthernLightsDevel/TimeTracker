<Window
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="clr-namespace:TimeTracker.Desktop.ProjectManagement"
    mc:Ignorable="d"
    x:Class="TimeTracker.Desktop.ProjectManagement.ProjectManagementWindow"
    x:CompileBindings="False"
    Width="820"
    Height="520"
    MinWidth="720"
    MinHeight="480"
    Title="Manage Customers &amp; Projects">
  <Grid RowDefinitions="Auto,*,Auto" ColumnDefinitions="*">
    <Border Margin="0,0,0,12" Padding="12" Background="#1d1d1d" Opacity="0.95">
      <StackPanel Orientation="Horizontal" HorizontalAlignment="Stretch" Spacing="12">
        <TextBlock Text="Project Management" FontSize="20" FontWeight="SemiBold" Foreground="White" />
        <TextBlock Text="{Binding StatusMessage}" Foreground="#DDDDDD" VerticalAlignment="Center" />
      </StackPanel>
    </Border>

    <Grid Grid.Row="1" ColumnDefinitions="2*,3*" ColumnSpacing="16">
      <Border Padding="16" CornerRadius="12" BorderBrush="#3A3A3A" BorderThickness="1">
        <StackPanel Spacing="10">
          <TextBlock Text="Customers" FontSize="16" FontWeight="SemiBold" />
          <StackPanel Orientation="Horizontal" Spacing="8">
            <TextBox
              Width="180"
              Watermark="New customer name"
              Text="{Binding NewCustomerName, UpdateSourceTrigger=PropertyChanged}" />
            <Button Content="Add" Command="{Binding AddCustomerCommand}" />
          </StackPanel>

          <ListBox
            Height="220"
            ItemsSource="{Binding Customers}"
            SelectedItem="{Binding SelectedCustomer}">
            <ListBox.ItemTemplate>
              <DataTemplate>
                <StackPanel Orientation="Horizontal" Spacing="6">
                  <TextBlock Text="{Binding DisplayName}" />
                </StackPanel>
              </DataTemplate>
            </ListBox.ItemTemplate>
          </ListBox>

          <Border BorderBrush="#3A3A3A" BorderThickness="1" Padding="10" CornerRadius="8">
            <StackPanel Spacing="8">
              <TextBlock Text="Selected Customer" FontWeight="SemiBold" />
              <TextBlock
                Text="Choose a customer to edit the name or archive state."
                FontSize="12"
                Opacity="0.7"
                TextWrapping="Wrap" />
              <TextBox
                IsEnabled="{Binding HasSelectedCustomer}"
                Watermark="Customer name"
                Text="{Binding CustomerNameInput, UpdateSourceTrigger=PropertyChanged}" />
              <CheckBox
                IsEnabled="{Binding HasSelectedCustomer}"
                Content="Archived"
                IsChecked="{Binding SelectedCustomerIsArchived}" />
              <Button
                Content="Save"
                HorizontalAlignment="Left"
                Command="{Binding SaveCustomerCommand}" />
            </StackPanel>
          </Border>
        </StackPanel>
      </Border>

      <Border Grid.Column="1" Padding="16" CornerRadius="12" BorderBrush="#3A3A3A" BorderThickness="1">
        <StackPanel Spacing="10">
          <TextBlock Text="Projects" FontSize="16" FontWeight="SemiBold" />
          <TextBlock
            Text="Projects belong to the selected customer. Use the fields below to add or edit entries."
            FontSize="12"
            TextWrapping="Wrap"
            Opacity="0.7" />

          <StackPanel Orientation="Horizontal" Spacing="8">
            <TextBox
              Width="220"
              Watermark="New project name"
              Text="{Binding NewProjectName, UpdateSourceTrigger=PropertyChanged}" />
            <Button Content="Add" Command="{Binding AddProjectCommand}" />
          </StackPanel>

          <ListBox
            Height="220"
            ItemsSource="{Binding Projects}"
            SelectedItem="{Binding SelectedProject}">
            <ListBox.ItemTemplate>
              <DataTemplate>
                <StackPanel Orientation="Horizontal" Spacing="6">
                  <TextBlock Text="{Binding DisplayName}" />
                  <TextBlock Text="â€¢" Opacity="0.5" />
                  <TextBlock Text="{Binding Status}" Foreground="{Binding StatusForeground}" />
                </StackPanel>
              </DataTemplate>
            </ListBox.ItemTemplate>
          </ListBox>

          <Border BorderBrush="#3A3A3A" BorderThickness="1" Padding="10" CornerRadius="8">
            <StackPanel Spacing="8">
              <TextBlock Text="Selected Project" FontWeight="SemiBold" />
              <TextBlock
                Text="Update the name, target customer, or active state, then save."
                FontSize="12"
                Opacity="0.7"
                TextWrapping="Wrap" />

              <TextBox
                IsEnabled="{Binding HasSelectedProject}"
                Watermark="Project name"
                Text="{Binding ProjectNameInput, UpdateSourceTrigger=PropertyChanged}" />

              <ComboBox
                IsEnabled="{Binding HasSelectedProject}"
                ItemsSource="{Binding Customers}"
                SelectedItem="{Binding SelectedProjectCustomer}"
                PlaceholderText="Select customer">
                <ComboBox.ItemTemplate>
                  <DataTemplate>
                    <TextBlock Text="{Binding DisplayName}" />
                  </DataTemplate>
                </ComboBox.ItemTemplate>
              </ComboBox>

              <CheckBox
                IsEnabled="{Binding HasSelectedProject}"
                Content="Active"
                IsChecked="{Binding SelectedProjectIsActive}" />

              <Button
                Content="Save Changes"
                HorizontalAlignment="Left"
                Command="{Binding SaveProjectCommand}" />
            </StackPanel>
          </Border>
        </StackPanel>
      </Border>
    </Grid>

    <Grid Grid.Row="2" ColumnDefinitions="*,Auto" Margin="0,12,0,0">
      <Button
        Content="Refresh"
        Width="100"
        Command="{Binding RefreshCommand}" />
      <Button
        Grid.Column="1"
        Width="100"
        Content="Close"
        Click="OnCloseClicked" />
    </Grid>
  </Grid>
</Window>
